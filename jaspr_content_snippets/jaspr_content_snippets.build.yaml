# NOTE: Always keep the section up until the other comment in sync with
# build.yaml.
# This overrides builders only for this package, allowing us to define custom
# targets only for this package.
builders:
  api_index:
    import: 'package:jaspr_content_snippets/builders.dart'
    build_to: cache
    builder_factories: ['DartIndexBuilder.new']
    auto_apply: all_packages
    runs_before: [jaspr_content_snippets]
    build_extensions: {"$package$": ['lib/api.json']}

  jaspr_content_snippets:
    import: 'package:jaspr_content_snippets/builders.dart'
    build_to: cache
    builder_factories: ['excerptsBuilder']
    auto_apply: none
    build_extensions: {'': ['.snippet.json']}
    defaults:
      options:
        process_without_directives: false
        drop_indentation: false

  combiner:
    import: 'package:jaspr_content_snippets/builders.dart'
    build_to: source
    builder_factories: ['combiner']
    auto_apply: root_package
    required_inputs:
      - ".snippet.json"
      - "api.json"
    build_extensions: {'$package$': ['lib/generated_snippets.dart']}
    defaults:
      options:
        path: lib/generated_snippets.dart
# End of section to keep in sync with build.yaml

targets:
  $default:
    builders:
      :jaspr_content_snippets:
        options:
          process_without_directives: true
        generate_for:
          - test/goldens/**
      :combiner:
        enabled: true
        options:
          path: test/goldens/generated_goldens.dart

global_options:
  ":api_index":
    options:
      packages: ['build', '$sdk']
